# Makefile 规则

建立并处理依存图，并据此更新特定的工作目标，就是`make`所要做的事情。

make允许使用各种类型的规则：

* 具体规则：用来指定需要更新的工作目标
* 模式规则：使用通配符而不是明确的文件名称
* 隐含规则：可以是模式规则，也可以是内置于make的后缀规则

### 具体规则

我们编写的规则多半会是具体规则，以特定的文件作为工作目标和必要条件。每个规则都可以有多个工作目标。着意味着，每个工作目标所具备的必要条件可以跟其他工作目标的一样，如果这些工作目标尚未被更新，则make将会为它们执行同一组更新动作。

`变量`：一个变量可以是一个美元符号后边跟着单一字符，也可以是一个美元符号后跟着一个加圆括号的单词

当模式出现在工作目标或必要条件中时，是由make进行通配符的扩展。然而当模式出现在命令中时，是由subshell进行扩展动作。

任何不代表文件的工作目标叫做假想工作目标，通常make总是会执行假想工作目标，因为对应于该规则的命令并不会创建以该工作目标为名称的文件。

GUN make提供了一个特殊的工作目标`.PHONY`，用来告诉make，该工作目标不是一个真正的文件。当你要声明假想工作目标时，只要将该工作目标指定成`.PHONY`的一个必要条件即可。

可以将假想工作目标作为内置在makefile里的shell脚本来用。以假想工作目标作为另一个工作目标的必要条件，可让make在进行实际工作目标之前调用假想工作目标所代表的脚本。

### 变量

一般来说，你必须以`$()`或`${}`将变量名称括住，这样make才会认得。有一个例外：变量名称若是单一字符则不需要为它加上圆括号。

当规则相符时，make会设定自动变量：

| 变量   | 说明                                       |
| ---- | ---------------------------------------- |
| `$@` | 工作目标的文件名                                 |
| `$%` | 档案文件成员结构中的文件名元素                          |
| `$<` | 第一个必要条件的文件名                              |
| `$?` | 时间戳在工作目标（的时间戳）之后的所有必要条件，并以空格隔开这些必要条件     |
| `$^` | 所有必要条件的文件名，并以空格隔开这些文件名。这份列表已删掉重复的文件名     |
| `$+` | 如同`$^`，代表所有必要条件的文件名，并以空格隔开这些文件名。不过`$+`包含重复的文件名 |
| `$*` | 工作目标的主文件名                                |

make会在规则与它的工作目标和必要条件相符之后设定自动变量，所以变量只能应用在规则中的命令脚本部分。

### 以`VPATH`和`vpath`来查找文件

可以使用`VPATH`和`vpath`来告诉make到不同的目录去查找源文件。

`VPATH`变量的内容是一份目录列表，可供make搜索其所需要的文件。这份目录列表可以用来搜索工作目标以及必要条件，但不包括脚本中所提及的文件。这份目录列表的分隔符在unix上可以使空格或冒号，在windows上可以是空格或分号。

虽然	`VPATH`变量可以解决以上的搜索问题，但是也有限制，make将会为它所需要的任何文件搜索VPATH列表中的牡蛎，如果在多个目录中出现同名的文件，则make只会提取第一个被找到的文件。有时着可能会造成问题。

此时可以使用`vpath`指令，这个指令的语法如下所示：

``` shell
vpath pattern directory-list
```

比如：

``` shell
vpath %.l %.c src
vpath %.h include
```

这样就告诉make应该在src目录中搜索.c文件，在include中搜索.h文件。

### 模式规则

`make --print-data-base`(或`-p`)列出make具有哪些默认规则（和变量）
