# AWK

Date: 2016-03-21

Tag: linux commandline awk

### awk程序模型

awk把输入流看做一连串记录的集合，每条记录都可以进一步细分为字段。通常一行一条记录，而字段则由一个或多个非空白字符的单词组成。（注：是什么构成一条记录和一个字段，完全是由程序员控制，且它们的定义，甚至可以在处理期间更改）

一个awk程序是一对`模式`与`大括号框起来的操作`组合而成的。针对每个匹配与输入数据的模式，操作都会被执行，且所有模式都会针对每条输入记录而检查。

`模式`或`操作`可省略其中一个
* 如果模式省略，则操作将被应用到每条输入记录。
* 如果操作省略，则默认操作为打印之记录在标准输出上。

如：

* `pattern { action }` 如果模式匹配，则执行操作
*  `pattern` 如果模式匹配，则打印记录
*   `{action}` 针对每条记录，执行操作

输入会自动地由一个输入文件切换到下一个，且`awk`本身通常会处理每个输入文件的打开、读取与关闭，以允许用户程序专心致力于记录的处理。不过awk以保留字`BEGIN`与`END`提供两种特殊模式。

* 与`BEGIN`关联的操作只会执行一次，在任何命令行文件或一般命令行赋值被处理之前，但是在任何开头的-v选项指定已经完成之后。它大部分是用户处理程序所需要的任何特殊初始化工作
* `END`操作也是只执行一次用于所有输入数据已被处理完之后。它多半用于产生摘要报告或是执行清除操作。


|    变量     | 说明          |
| ------------- |:-------------:|
|FILENAME|当前输入文件的名称|
|FNR|当前输入文件的记录数|
|FS|字段分隔符（正则表达式）（默认为：”“）|
|NF|当前记录的字段数|
|NR|在工作（JOB）中的记录数 |
|OFS|输出字段分隔字符（默认为：”“）
|ORS|输出记录分隔字符（默认为"\n"）
|RS|输入记录分割字符（仅用于gawk与mawk里的正则表达式）（默认为："\n"）

awk大量的借用C程序语言的语句以提供功能。

在子函数中：标量为传值而数组则为传引用

所有用于函数体而未出现在参数列表中的变量，都被视为全局性的，AWK允许在被调用函数中的参数比函数定义里所声明的参数还要少，额外的参数会被视为局部变量。
