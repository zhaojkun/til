# TCP中相关算法

* 慢启动算法
  慢启动为发送发的TCP增加了另一个窗口：阻塞窗口，记为cwnd。当与网络的另一台主机建立TCP连接时，拥塞窗口被初始化为1个报文段的大小，发送方去阻塞窗口与通告窗口两者中的最小值作为发送上限。每受到一个ACK，阻塞窗口增加一个报文段大小。

  阻塞窗口是发送方使用的流量控制，而窗口通告是接收方使用的流量控制。

* 拥塞避免算法
  在慢启动阶段，窗口的增长本质上是以指数方式进行的，窗口的过快增长可能使得数据快速达到中间路由器的极限。因此在慢启动的基础上还需要附加一种拥塞避免算法，当`TCP`进入拥塞避免阶段，减小阻塞窗口的增长速度，在该阶段下，只有窗口中的所有报文段被确认后，窗口值才加`1`，这就是`加法增加`

* 慢启动算法与拥塞避免算法总结如下：

  发送方需要为慢启动算法和拥塞避免算法维持两个变量：一个阻塞窗口`cwnd`和一个拥塞避免启动门限`ssthresh`，上述算法按照以下过程进行：

  * 对于一个新建立的链接，初始化阻塞窗口`cwnd`为`1`个报文段的大小
  * 发送方可以发送的数据量不能超过当前有效发送窗口的大小（有效发送窗口为拥塞窗口`cwnd`和接受通告窗口的小者）。
  * 当发送方检测到拥塞时（超时或收到重复确认），`ssthresh`被设置为当前有效发送窗口的一半（至少为2个报文段），`cwnd`被设置为1个报文段大小。
  * 当有新数据被对方确认时，发送方就增加`cwnd`，增加`cwnd`的方式依赖于我们是处于慢启动阶段还是拥塞避免阶段：如果`cwnd`小于或等于`ssthresh`，则处于慢启动阶段；否则处于拥塞避免阶段。慢启动阶段采用慢启动算法更新`cwnd`，拥塞避免阶段采用拥塞避免算法更新`cwnd`。
    慢启动算法设置`cwnd`为一个报文段的大小，此后每收到一个确认就加1，这会使窗口按指数方式增长。拥塞避免算法要求每收到一个确认时，将`cwnd`增加`1/cwnd`。当整个窗口内的数据被确认时，`cwnd`只增加了1。


* 快速重传算法
  如果发送方一连串收到3个或3个以上的重复ACK，就非常可能是一个报文段丢失。于是发送方就重传丢失的报文段而无需等待超时定时器溢出，这就是快速重传算法。快速重传算法能在偶尔丢失的环境中达到很高的吞吐量。
  当快速重传发生时，链接处于快速重传模式，阻塞窗口直接被设置为有效窗口的一半（或更多），使得重传报文段的时候，其他报文段也能够处于双方的传输途中。如果在这种情况下，让收到重复的`ACK`，则每个`ACK`都将阻塞窗口增加一个报文段，即在此过程中，执行`慢启动算法`
* 快速恢复
  当控制块退出快速重传模式后，阻塞窗口不会像超时那样被设置为`1`，相反阻塞窗口被设置为`ssthresh`，连接直接进入拥塞避免阶段，这就是所谓的快速恢复
* 快速重传算法与快速恢复算法总结如下：
  * 当收到第`3`个重复的`ACK`时，将`ssthresh`设置为当前有效发送窗口的一半（但至少为两个报文段大小）。重传丢失的报文段。设置`cwnd`为`ssthresh`加上`3`倍的报文段大小。
  * 每收到一个重复的`ACK`，`cwnd`增加一个报文段（如果窗口允许，则发送新的报文段）
  * 当下一个确认新数据的`ACK`到达时，设置`cwnd`为`ssthresh`，即后续直接执行拥塞避免算法调整阻塞窗口。
